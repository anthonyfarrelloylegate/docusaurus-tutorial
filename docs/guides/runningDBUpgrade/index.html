<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Performing a Database Upgrade · Reporting Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;overview&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#overview&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Performing a Database Upgrade · Reporting Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://anthonyfarrelloylegate.github.io/docusaurus-tutorial/"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;overview&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#overview&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;
"/><meta property="og:image" content="https://anthonyfarrelloylegate.github.io/docusaurus-tutorial/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://anthonyfarrelloylegate.github.io/docusaurus-tutorial/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/docusaurus-tutorial/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/docusaurus-tutorial/css/main.css"/><script src="/docusaurus-tutorial/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docusaurus-tutorial/"><img class="logo" src="/docusaurus-tutorial/img/undraw_analytics_5pgy.svg" alt="Reporting Documentation"/><h2 class="headerTitleWithLogo">Reporting Documentation</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docusaurus-tutorial/docs/started/gettingStarted" target="_self">Developer Docs</a></li><li class=""><a href="/docusaurus-tutorial/help" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Releases &amp; Releasing<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/ReleaseSchedule">Release Schedule View</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/rc">Release Candidates View</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/rctakeon">Development Release Take-on</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/streams">Streams View</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/releaseprocess">How to build a Release</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/cipipeline">Jenkins Pipelines</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/releases/oss">OSS resources</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/gettingStarted">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/rtc">Get Codebase from RTC</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/git">Get Codebase from Git</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/bootstrap">Get Development tools</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/projstruct">Reporting Project Structure</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/started/buildingCL">Building Your Environment</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/projectstructure">Project Structure</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/buildCL">Build Commands</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/usingarelease">Using Released Software</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docusaurus-tutorial/docs/guides/runningDBUpgrade">Performing a Database Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/runningDBCreation">Performing a New Reporting Schema</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/runningETL">Performing ETL Execution</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/performingEncryption">Performing Password Encryption</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/cognosTasks">Performing Cognos Tasks</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Development Best Practices</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/guides/devbestpractices">Development Best Practices Overview</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Building This Site<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docusaurus-tutorial/docs/builddoc/docbuild">How to contribute to this site</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Performing a Database Upgrade</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>The build task bootJar builds the upgrade application jar file into the project build/libs directory.  The application jar is then copied into a release zip for distribution.</p>
<p>Configuration parameters are passed into the update application using a Spring Boot YAML configuration profile file.   See below for a description of each of the configuration properties that are are applicable to the database upgrade process.</p>
<h2><a class="anchor" aria-hidden="true" id="reporting-schema-upgrade"></a><a href="#reporting-schema-upgrade" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reporting Schema Upgrade</h2>
<p>To deploy a database upgrade to a Reporting instance you run the application as follows.  The database change logs are defined in the <strong>ReportingSchema project</strong> (folder) with a new folder created for each release, e.g. <strong><a href="https://github.ibm.com/WH-GovHHS/wcm-reporting/tree/master/ReportingSchemaUpgrade/1.1.71">see 1.1.74</a></strong> which represents the 19:06 release.</p>
<p>Creating a release zip bundles the change logs into the database upgrade application, the database upgrade application is then executed which deploys the change logs.  To run the application see the example below.</p>
<p>Both of the following are methods can be used within the development stream. The task bootRun builds and the executes the application, great when you are making frequently changes to be tested immediately.  The second method simply runs the application; it assumes the bootJar task has been previously executed.</p>
<h2><a class="anchor" aria-hidden="true" id="using-bootrun"></a><a href="#using-bootrun" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using bootRun</h2>
<pre><code class="hljs css language-sh">./gradlew :LiquibaseApplication:bootRun  --args=<span class="hljs-string">"--spring.config.name=wcmReporting --spring.config.location=file:<span class="hljs-variable">$PWD</span>/builderResources/ --spring.profiles.active=LOCAL_ANTHONY,dev --upgradetask=VALIDATE"</span>  
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="using-the-executable-jar"></a><a href="#using-the-executable-jar" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using the Executable jar</h2>
<pre><code class="hljs css language-sh">java -jar com.ibm.wcm.reporting.liquibase.application-1.0.jar --spring.config.name=wcmReporting  --spring.config.location=file:./builderResources/ --spring.profiles.active=FVT,dev --upgradetask=VALIDATE
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="configuration-parameters-explained"></a><a href="#configuration-parameters-explained" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Parameters Explained</h2>
<p>The configuration values for the upgrade are read from the configuration profile and explained below.  See also the example helm configuration <strong><a href="https://github.ibm.com/WH-GovHHS/wcm-reporting/blob/master/helm/configs/WCMReporting.yml">WCMReporting.yml</a></strong>.</p>
<p>The configuration YAML file is maintained manually for our development pipelines.  When deployed to the IBM Cloud the YAML file is created and injected at runtime.</p>
<p>Notes:</p>
<ul>
<li>Single tenant.  To run the upgrade for a single tenant you can use the <strong>schemaname</strong> element within the target and source elements. This supports development tasks and our Jenkins builders. Alternatively add a single schema name to the multitenant element, see next.</li>
<li>multitenant.  This element overrides the <strong>schemaname</strong> element.  This element contains the set of schema names present in a multi-tenant WCM stack.  When this element is set a Reporting upgrade is applied to each schema in sequential order.</li>
<li>STATUS &amp; VALIDATE.  These options are mainly used by the development team.</li>
<li>Active profile.  For production the profile is set to the value &quot;prod&quot;</li>
</ul>
<pre><code class="hljs">spring<span class="hljs-selector-class">.profiles</span><span class="hljs-selector-class">.active</span>=prod
</code></pre>
<p>Configuration data required by the application.</p>
<pre><code class="hljs"><span class="hljs-comment"># database upgrade options: STATUS(unrun changesets) | VALIDATE(xml validate) | UPGRADE(perform the upgrade)</span>
<span class="hljs-comment"># default for production is UPGRADE</span>
<span class="hljs-attr">upgradetask:</span> <span class="hljs-string">UPGRADE</span>
<span class="hljs-comment">#list of schemas in this stack.</span>
<span class="hljs-attr">multitenant:</span><span class="hljs-string">T_tenantID_instanceID_1,</span> <span class="hljs-string">T_tenantID_instanceID_2</span>
<span class="hljs-attr">target:</span>
<span class="hljs-attr">  userid:</span> <span class="hljs-string">scdb2</span>
<span class="hljs-attr">  password:</span> <span class="hljs-string">encryptedPassword</span>
<span class="hljs-attr">  jdbcURL:</span> <span class="hljs-attr">jdbc:db2://reporting02.mulvm.ie.ibm.com:50000/curamDW</span>
<span class="hljs-attr">  schemaname:</span> <span class="hljs-string">T_tenantID_instanceID</span>
<span class="hljs-attr">source:</span>
<span class="hljs-attr">  userid:</span> <span class="hljs-string">scdb2</span>
<span class="hljs-attr">  password:</span> <span class="hljs-string">encryptedPassword</span>
<span class="hljs-attr">  jdbcURL:</span> <span class="hljs-attr">jdbc:db2://ba-wcm-02.mulvm.ie.ibm.com:50000/curam</span>
<span class="hljs-attr">  schemaname:</span> <span class="hljs-string">T_tenantID_instanceID</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docusaurus-tutorial/docs/guides/usingarelease"><span class="arrow-prev">← </span><span>Using Released Software</span></a><a class="docs-next button" href="/docusaurus-tutorial/docs/guides/runningDBCreation"><span>Performing a New Reporting Schema</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#reporting-schema-upgrade">Reporting Schema Upgrade</a></li><li><a href="#using-bootrun">Using bootRun</a></li><li><a href="#using-the-executable-jar">Using the Executable jar</a></li><li><a href="#configuration-parameters-explained">Configuration Parameters Explained</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="https://github.ibm.com/WH-GovHHS/WCM-Reporting">WCM Reporting on Github</a><a href="https://github.ibm.com/WH-GovHHS/WCM-Reporting">WCM Reporting Documenation on Github</a><a href="https://docusaurus.io" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/docusaurus-tutorial/img/docusaurus.ico" alt="Docusaurus" width="30" height="30"/>Docusaurus</a><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/docusaurus-tutorial/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 IBM</section></section></footer></div></body></html>